<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./assets/images/logo.jpg" type="image/icon type">
    <title>Détails du produit</title>
    <link rel="stylesheet" href="./assets/CSS/styles.css">
</head>

<body>
    <header>
        <h1>Détails du produit</h1>
    </header>
    <main id="product-details">
        <!-- Les détails du produit seront chargés ici -->
    </main>
    <footer>
        <a href="index.html">Retour à la page principale</a>
    </footer>

    <script>
        function loadProductDetails() {
            const params = new URLSearchParams(window.location.search);
            const productId = params.get('id');

            if (productId) {
                fetch(`http://localhost:3000/produit/${productId}`)
                    .then(response => response.json())
                    .then(data => {
                        const detailsContainer = document.getElementById('product-details');
                        if (data) {
                            detailsContainer.innerHTML = `
                         <strong>Nom :</strong> ${data.product.name}<br>
                         <strong>By :</strong> ${data.product.owner}<br>
                            <strong>Type :</strong> ${data.product.echange_type}<br>
                            <strong>Contre :</strong> ${data.product.echange_contre}<br>
                            <strong>Disponibilité :</strong> ${data.product.status === "AVAILABLE" ? "Disponible" : "Plus en stock"}<br>
                            ${data.product.image ? `<img src="uploads/${data.product.image}" alt="Product image" style="max-width: 200px;"><br>` : ''}
                        `;

                            fetch(`http://localhost:3000/user/${data.product.owner}`)
                                .then(response => response.json())
                                .then(owner_data => {
                                    detailsContainer.innerHTML += owner_data ? 
                                    `<strong>Numéro de téléphone :</strong> ${owner_data.tel}<br>
                                     <strong>Email :</strong> ${owner_data.email ? owner_data.email : "Aucun"}<br>` : ""
                                }).catch(error => {
                                    console.error('Error:', error);
                                    document.getElementById('product-details').innerHTML = error
                                });
                        } else {
                            detailsContainer.innerHTML = '<p>Produit non trouvé.</p>';
                        }
                    
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById('product-details').innerHTML = '<p>Erreur lors du chargement des détails du produit.</p>';
                    });
            } else {
                document.getElementById('product-details').innerHTML = '<p>ID du produit manquant.</p>';
            }
        }

        document.addEventListener("DOMContentLoaded", loadProductDetails);
    </script>
</body>

</html>